<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test Workspace API</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #1e1e1e;
      color: #00ff00;
      padding: 20px;
    }
    .log {
      background: #0a0a0a;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
      border-left: 3px solid #00ff00;
    }
    .error {
      border-left-color: #ff0000;
      color: #ff6b6b;
    }
    .success {
      border-left-color: #00ff00;
      color: #51cf66;
    }
    .warning {
      border-left-color: #ffd43b;
      color: #ffd43b;
    }
    h1 {
      color: #00d9ff;
      text-align: center;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      background: #2a2a2a;
      border-radius: 5px;
    }
    .test-section h2 {
      color: #ff9f43;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ”¬ TEST WORKSPACE API - MÃ©thodes Disponibles</h1>
  
  <div class="test-section">
    <h2>ğŸ“‹ Ã‰tat de la connexion</h2>
    <div id="connection-status">En attente...</div>
  </div>

  <div class="test-section">
    <h2>ğŸ” MÃ©thodes disponibles dans api.todos</h2>
    <div id="todos-methods">En cours de test...</div>
  </div>

  <div class="test-section">
    <h2>ğŸ”§ MÃ©thodes disponibles dans api.bcf</h2>
    <div id="bcf-methods">En cours de test...</div>
  </div>

  <div class="test-section">
    <h2>ğŸ‘ï¸ MÃ©thodes disponibles dans api.views</h2>
    <div id="views-methods">En cours de test...</div>
  </div>

  <div class="test-section">
    <h2>ğŸ“ MÃ©thodes disponibles dans api.files</h2>
    <div id="files-methods">En cours de test...</div>
  </div>

  <div class="test-section">
    <h2>ğŸ§ª Test des appels API</h2>
    <div id="api-tests">En attente de la connexion...</div>
  </div>

  <script type="module">
    const TrimbleConnectWorkspace = window.TrimbleConnectWorkspace;

    function log(containerId, message, type = 'log') {
      const container = document.getElementById(containerId);
      const logDiv = document.createElement('div');
      logDiv.className = `log ${type}`;
      logDiv.textContent = message;
      container.appendChild(logDiv);
    }

    function clearLog(containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
    }

    async function testWorkspaceAPI() {
      try {
        // Connexion
        log('connection-status', 'ğŸ”Œ Connexion Ã  TrimbleConnectWorkspace...', 'log');
        
        const api = await TrimbleConnectWorkspace.connect(
          window.parent,
          (event, args) => {
            console.log('ğŸ“¡ Event:', event, args);
          }
        );

        log('connection-status', 'âœ… Connexion Ã©tablie avec succÃ¨s!', 'success');

        // IMPORTANT: Configurer le menu pour apparaÃ®tre dans le panneau latÃ©ral
        api.ui.setMenu({
          title: 'TEST API',
          icon: 'https://simontrim.github.io/trimble-dashboard/public/icon-48.png',
          command: 'show_test'
        });
        log('connection-status', 'âœ… Menu configurÃ© - L\'extension devrait apparaÃ®tre dans le panneau latÃ©ral', 'success');

        // RÃ©cupÃ©rer le projet
        const project = await api.project.getCurrentProject();
        log('connection-status', `ğŸ“ Projet: ${project.name} (ID: ${project.id})`, 'success');

        // TEST 1: VÃ©rifier api.todos
        clearLog('todos-methods');
        log('todos-methods', 'ğŸ” Inspection de api.todos...', 'log');
        
        if (api.todos) {
          log('todos-methods', 'âœ… api.todos existe!', 'success');
          log('todos-methods', `MÃ©thodes disponibles: ${Object.keys(api.todos).join(', ')}`, 'log');
          
          // Tester getAll
          if (typeof api.todos.getAll === 'function') {
            log('todos-methods', 'âœ… api.todos.getAll() existe - Test en cours...', 'success');
            try {
              const todos = await api.todos.getAll();
              log('api-tests', `âœ… api.todos.getAll() fonctionne! RÃ©cupÃ©rÃ©: ${todos.length} todos`, 'success');
              log('api-tests', `Premier todo: ${JSON.stringify(todos[0], null, 2)}`, 'log');
            } catch (error) {
              log('api-tests', `âŒ api.todos.getAll() existe mais Ã©choue: ${error.message}`, 'error');
            }
          } else {
            log('todos-methods', 'âŒ api.todos.getAll() N\'EXISTE PAS', 'error');
          }
        } else {
          log('todos-methods', 'âŒ api.todos N\'EXISTE PAS', 'error');
        }

        // TEST 2: VÃ©rifier api.bcf
        clearLog('bcf-methods');
        log('bcf-methods', 'ğŸ” Inspection de api.bcf...', 'log');
        
        if (api.bcf) {
          log('bcf-methods', 'âœ… api.bcf existe!', 'success');
          log('bcf-methods', `MÃ©thodes disponibles: ${Object.keys(api.bcf).join(', ')}`, 'log');
          
          // Tester getTopics
          if (typeof api.bcf.getTopics === 'function') {
            log('bcf-methods', 'âœ… api.bcf.getTopics() existe - Test en cours...', 'success');
            try {
              const topics = await api.bcf.getTopics();
              log('api-tests', `âœ… api.bcf.getTopics() fonctionne! RÃ©cupÃ©rÃ©: ${topics.length} topics`, 'success');
            } catch (error) {
              log('api-tests', `âŒ api.bcf.getTopics() existe mais Ã©choue: ${error.message}`, 'error');
            }
          } else {
            log('bcf-methods', 'âŒ api.bcf.getTopics() N\'EXISTE PAS', 'error');
          }
        } else {
          log('bcf-methods', 'âŒ api.bcf N\'EXISTE PAS', 'error');
        }

        // TEST 3: VÃ©rifier api.views
        clearLog('views-methods');
        log('views-methods', 'ğŸ” Inspection de api.views...', 'log');
        
        if (api.views) {
          log('views-methods', 'âœ… api.views existe!', 'success');
          log('views-methods', `MÃ©thodes disponibles: ${Object.keys(api.views).join(', ')}`, 'log');
          
          if (typeof api.views.getAll === 'function') {
            log('views-methods', 'âœ… api.views.getAll() existe - Test en cours...', 'success');
            try {
              const views = await api.views.getAll();
              log('api-tests', `âœ… api.views.getAll() fonctionne! RÃ©cupÃ©rÃ©: ${views.length} vues`, 'success');
            } catch (error) {
              log('api-tests', `âŒ api.views.getAll() existe mais Ã©choue: ${error.message}`, 'error');
            }
          } else {
            log('views-methods', 'âŒ api.views.getAll() N\'EXISTE PAS', 'error');
          }
        } else {
          log('views-methods', 'âŒ api.views N\'EXISTE PAS', 'error');
        }

        // TEST 4: VÃ©rifier api.files
        clearLog('files-methods');
        log('files-methods', 'ğŸ” Inspection de api.files...', 'log');
        
        if (api.files) {
          log('files-methods', 'âœ… api.files existe!', 'success');
          log('files-methods', `MÃ©thodes disponibles: ${Object.keys(api.files).join(', ')}`, 'log');
          
          if (typeof api.files.getFiles === 'function') {
            log('files-methods', 'âœ… api.files.getFiles() existe - Test en cours...', 'success');
            try {
              const files = await api.files.getFiles('/');
              log('api-tests', `âœ… api.files.getFiles('/') fonctionne! RÃ©cupÃ©rÃ©: ${files.length} items`, 'success');
            } catch (error) {
              log('api-tests', `âŒ api.files.getFiles() existe mais Ã©choue: ${error.message}`, 'error');
            }
          } else {
            log('files-methods', 'âŒ api.files.getFiles() N\'EXISTE PAS', 'error');
          }
        } else {
          log('files-methods', 'âŒ api.files N\'EXISTE PAS', 'error');
        }

        // RÃ‰SUMÃ‰
        log('api-tests', 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'warning');
        log('api-tests', 'ğŸ“Š RÃ‰SUMÃ‰ DES TESTS', 'warning');
        log('api-tests', 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'warning');

        // Afficher toutes les clÃ©s disponibles dans api
        log('api-tests', `ğŸ”‘ ClÃ©s disponibles dans api: ${Object.keys(api).join(', ')}`, 'log');

      } catch (error) {
        log('connection-status', `âŒ Erreur de connexion: ${error.message}`, 'error');
        log('connection-status', `Stack: ${error.stack}`, 'error');
      }
    }

    // DÃ©marrer les tests
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ§ª DÃ©marrage des tests...');
      testWorkspaceAPI();
    });
  </script>
</body>
</html>
